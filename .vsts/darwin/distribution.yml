steps:
  - template: ./darwin-dependencies.yml
  - script: |
      npm run -s build:prod
      npm run -s build-python
      npm run -s package darwin-app
      rm -rf ./release/mac/*.app
    displayName: Build .app

  - template: ./sign.yml
  - script: |
      unzip ./release/BatchExplorer*.zip -d ./release/mac
      rm -f ./release/mac/*.pkg
      rm -rf ./release/*.zip
      npm run -s package darwin-dmg
      rm -rf ./release/mac/*
    displayName: Build dmg

  - template: ../common/publish-artifacts.yml
    parameters:
      folder: darwin
