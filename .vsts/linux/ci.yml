steps:
  - template: ./linux-dependencies.yml

  - script: |
      set -e
      . "$(Agent.WorkFolder)/.venv/batchexplorer/bin/activate"
      npm run build:package
    displayName: Build and pack

  - script: |
      set -e
      cd $BUILD_SOURCESDIRECTORY
      git status --porcelain=v1
      changed=$(git diff --name-only --ignore-all-space)
      echo "Changed files: $changed"
      if [ -n "$changed" ]; then
        for file in $changed; do
          if [[ $(git diff "$file" | tail -n +5 | grep -c '^[+-]') -ne 0 ]]; then
            echo "Text changes detected in $file. Pipeline failed."
            exit 1
          fi
        done
        echo "No text changes detected. Continuing pipeline."
      else
        echo "No changes detected. Continuing pipeline."
      fi
    workingDirectory: desktop
    displayName: Validate no files changed on build


  - template: ../common/publish-artifacts.yml
    parameters:
      folder: linux
