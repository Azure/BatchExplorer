<div class="slideout-form content-wrapper node-connect" *ngIf="node && pool">
    <div class="connect-content">
        <div class="sidebar-header">
            <h1>Connect to node</h1>
            <bl-button skipSuccess type="plain" [action]="close"><i class="fa fa-times fa-lg"></i></bl-button>
        </div>
        <div *ngIf="credentialSource === null">
            <div class="node-information">
                <bl-property-group>
                    <!-- If waiting for connection settings -->
                    <bl-text-property *ngIf="!connectionSettings" label="IP" value="Fetching..."></bl-text-property>
                    <bl-text-property *ngIf="!connectionSettings" label="Port" value="Fetching..."></bl-text-property>
                    <!-- Once connection settings are fetched -->
                    <bl-text-property *ngIf="connectionSettings" label="IP" [value]="connectionSettings.ip"></bl-text-property>
                    <bl-text-property *ngIf="connectionSettings" label="Port" [value]="connectionSettings.port"></bl-text-property>
                    <div class="custom-property">
                        <h5 class="label-small username-label">Username</h5>
                        <input autofocus blInput type="text" id="input-username" [placeholder]="defaultUsername" />
                    </div>
                    <div class="custom-property" *ngIf="linux">
                        <h5 class="label-small">Key File</h5>
                        <div>{{publicKeyFile}}</div>
                    </div>
                </bl-property-group>
            </div>
            <div class="credentials-source">
                <bl-button type="wide" [action]="autoConnect" [disabled]="!hasLocalPublicKey" [matTooltip]="quickStartTooltip" [matTooltipDisabled]="hasLocalPublicKey">
                    <div class="button-icon-frame">
                        <i class="fa fa-plug fa-fw"></i>
                    </div>
                    <div class="button-label">Connect</div>
                </bl-button>
                <bl-button type="wide" [action]="specifyCredentials">
                    <div class="button-icon-frame">
                        <i class="fa fa-wrench fa-fw"></i>
                    </div>
                    <div class="button-label">Configure</div>
                </bl-button>
            </div>
        </div>
        <div *ngIf="credentialSource === CredentialSource.Specified && !credentials">
            <bl-node-user-credentials-form [submit]="addOrUpdateUser" [isLinuxNode]="linux" (close)="goToHome()"></bl-node-user-credentials-form>
        </div>
        <div *ngIf="hasIp && connectionSettings && credentials">
            <div class="waiting-for-process" *ngIf="credentialSource === CredentialSource.Generated && !processLaunched">
                <bl-loading></bl-loading>
                <div>Connecting to node...</div>
            </div>
            <div *ngIf="processLaunched">
                <div class="warn-text" *ngIf="expireTime">Note: These credentials are valid until {{expireTime}} on this node.</div>
                <bl-property-group>
                    <bl-text-property label="IP" [value]="connectionSettings.ip"></bl-text-property>
                    <bl-text-property label="Port" [value]="connectionSettings.port"></bl-text-property>
                    <bl-text-property label="Username" [value]="credentials.name"></bl-text-property>
                    <bl-text-property label="Key File" [value]="publicKeyFile"></bl-text-property>
                </bl-property-group>
            </div>
        </div>
    </div>
    <div class="action-btns">
        <span *ngIf="credentials && windows && agentSkus">
            <bl-download-rdp [nodeId]="node.id" [credentials]="credentials" [rdpContent]="rdpContent" [connectionSettings]="connectionSettings"></bl-download-rdp>
        </span>
    </div>
    <div *ngIf="credentialSource === CredentialSource.Generated || credentialSource === CredentialSource.Specified">
        <bl-button color="light" type="wide" [action]="goToHome">Back</bl-button>
    </div>
</div>
