# BatchManagement REST client library

This directory contains the Batch Management plane RLC (Rest Level Client) library intended for use within the Shared Library for Batch Explorer and the Portal. This package acts as a data and service communication layer for invoking REST API calls for the Batch Management plane. Currently, there is a lot of code duplication between the Portal and Batch Explorer, so this package acts as an environment agnostic library to be used in both the Portal and Batch Explorer to eliminate custom code duplication between the two environments. In this context, a RLC (Rest Level Client) is an Azure specific SDK flavor that emphasizes seamless developer experience by acting as a layer above raw HTTP calls. One of the major benefits of this SDK type is that they provide a compact, browser friendly bundle size footprint by relying on an abstract REST client and contains Batch specific Typescript type definitions as oppose to exportable classes. More information about RLCs can be found [here](https://devblogs.microsoft.com/azure-sdk/azure-rest-libraries-for-javascript/).

## Development Prerequisites

Before developing against this library, please consult the __Developer Prerequisites__ section of the README under the <ROOT_DIR>/packages/ directory.

## Package Layout

This SDK library is built through autogenerated code by invoking autorest with our Batch Management swagger configuration file hosted at <https://github.com/Azure/azure-rest-api-specs/tree/main/specification/batch/resource-manager/Microsoft.Batch/stable>.

- `swagger` - This subdirectory contains the swagger configuration file containing documented autorest command options to make the code regeneration process easier to invoke in case there is a need to refresh the rest api input file or other changes. The associated README.md configuration file contains autorest command options such as: package name and version, swagger input file, source code folder path, client authentication customization, etc. One of the command options within the file is the __input-file__ option which is a link to the openAPI Batch swagger file under the public [Azure Rest API Spec repo](https://github.com/Azure/azure-rest-api-specs). In order to regenerate the SDK to pick up the latest API swagger definitions, you will need to change the input-file path to point to the file denoted under the latest API version.

To invoke autorest and regenerate the code, run the following from the root of the subproject:

```shell
npm run generate:client
```

This will parse the command options from the README and regenerate the SDK code within the src/generated folder.

- `src` - This subdirectory contains all the source code, both generated and manually written.
    - `src/generated/` - This holds the swagger autogenerated code such as obtaining the client and Batch specific modeless interfaces. These files should generally not be modified manually.
    - `src/http/` - This contains manually written HTTP related code such as parsing the custom http client from the Shared Library common and generated SDK HTTP Client interface.

## Building and Running Tests

If this is the first time building the Batch Management plane client, then please consult the __Building and Running Tests__ section of the README under the <ROOT_DIR>/packages/ directory to install local dependencies and build common tools needed to build the Batch Management plane client.

Otherwise, you can run the following from the same directory as this README.md:

```shell
npm run build
```

## Unit Tests

Invoking `npm test` will directly invoke Jest and run all the test suites as exists under __src/__. If you would like to test a particular test file, you can pass the test file relative path to the command i.e. `npm test -- .\src\__tests__\batch-management-client.spec.ts`.

The tests defined in the `batch-management-client.spec.ts` file utilizes the MockHttpClient and MockEnvironment defined within the common/ui-common sub-module to test a BatchManagementClient instance. Rather than making direct REST API calls to the management plane, the API responses will be mocked.
