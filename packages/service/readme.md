# Batch Service Libaray

This package intended to act as a decoupled data access & business logic layer for the Batch service, which also including two Rest Level Client (RLC) for the Batch Data plane and Batch Management plane.

The RLCs are intended to be used within the Shared Library for Batch Explorer and the Portal. Currently, there is a lot of code duplication between the Portal and Batch Explorer, so this package acts as an environment agnostic library to be used in both the Portal and Batch Explorer to eliminate custom code duplication between the two environments. In this context, a RLC (Rest Level Client) is an Azure specific SDK flavor that emphasizes seamless developer experience by acting as a layer above raw HTTP calls. One of the major benefits of this SDK type is that they provide a compact, browser friendly bundle size footprint by relying on an abstract REST client and contains Batch specific Typescript type definitions as oppose to exportable classes. More information about RLCs can be found [here](https://devblogs.microsoft.com/azure-sdk/azure-rest-libraries-for-javascript/).


## Development Prerequisites

Before developing against this library, please consult the __Developer Prerequisites__ section of `<ROOT_DIR>/packages/README.md`.


## Package Layout

- `src/internal/batch-rest` contains the Batch Data plane RLC

- `src/internal/arm-batch-rest` contains the Batch Management plane RLC\

- `src/internal/client-http` contains the HTTP client code that is shared between the Batch Data plane and Batch Management plane RLCs

- `swagger` - This subdirectory contains the swagger configuration file containing documented autorest command options to make the __Batch Management RLC__ code regeneration process easier to invoke in case there is a need to refresh the rest api input file or other changes. The associated README.md configuration file contains autorest command options such as: package name and version, swagger input file, source code folder path, client authentication customization, etc. One of the command options within the file is the __input-file__ option which is a link to the openAPI Batch swagger file under the public [Azure Rest API Spec repo](https://github.com/Azure/azure-rest-api-specs). In order to regenerate the SDK to pick up the latest API swagger definitions, you will need to change the input-file path to point to the file denoted under the latest API version.

- `<ROOT_DIR>/eng/emitter-package.json` - This file is used by `tsp-client` to install the required dependencies to setup the local TypeSpec project for generating the Batch Data plane RLC, see more details in the [Azure JS SDK RLC quickstart](https://github.com/Azure/azure-sdk-for-js/blob/main/documentation/RLC-quickstart.md) and [tsp-client npm readme](https://www.npmjs.com/package/@azure-tools/typespec-client-generator-cli)


## Generating the Batch Data Plane RLC

First make sure `src\internal\batch-rest\generated\tsp-location.yaml` is updated with the __github__ repo and the commit hash which has the targeted `tsconfig.yml` and `*.tsp` files. Then then run the following from the root of this subproject:


```shell
npm run generate:client
```

This will execute `generate-client.ps1` which runs `tsp-client` command to fetch the remote `tsconfig.yml` and `*.tsp` files and install the required dependencies for a local TypeSpec project in `src/internal/arm-batch-rest/generated/TempTypeSpecFiles`, which shouldn't be checked in as is temporaty. Then, the `tsp-client` will generate the Batch Data plane RLC code based on this local TypeSpec project, see more details in the [tsp-client npm readme](https://www.npmjs.com/package/@azure-tools/typespec-client-generator-cli)

- `src/internal/batch-rest/generated/src` - This holds the autogenerated code such as obtaining the client and Batch specific modeless interfaces. These files should generally not be modified manually.

## Generating the Batch Management RLC

First make sure `input-file` in `swagger/README.md` is pointing to the latest API version. Then then run the following from the root of this subproject:

```shell
npm run generate:arm-client
```

This will parse the command options from the README and regenerate the SDK code

- `src/internal/arm-batch-rest/generated` - This holds the swagger autogenerated code such as obtaining the client and Batch specific modeless interfaces. These files should generally not be modified manually.



